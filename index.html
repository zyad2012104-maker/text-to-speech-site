<!doctype html>
<html lang="ar">
<head> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8584077826935053"
     crossorigin="anonymous"></script> <head>
  
  <meta charset="utf-8">
  <title>تحويل النص إلى صوت (VoiceRSS)</title>
  <!-- GOOGLE ADSENSE CODE HERE -->
  <style>
    body{font-family:sans-serif;max-width:700px;margin:30px auto;padding:10px;}
    textarea{width:100%;height:120px;padding:8px;}
    button{padding:10px 20px;margin-top:10px;background:#28a745;color:#fff;border:none;border-radius:6px;cursor:pointer}
    select,input{margin-top:10px;padding:5px;}
  </style>
</head>
<body>
  <h2>تحويل النص إلى صوت (MP3 قابل للتحميل)</h2>
  <textarea id="txt" placeholder="أدخل النص هنا..."></textarea>
  <div>
    <label>اللغة:</label>
    <select id="lang">
      <option value="ar-eg">العربية (مصر)</option>
      <option value="en-us">English (US)</option>
      <option value="fr-fr">Français</option>
      <option value="de-de">Deutsch</option>
    </select>
  </div>
  <div>
    <label for="voice">اختر الصوت:</label>
<select id="voice">
  <option value="Hossam">رجل</option>
  <option value="Salma">امرأة</option>
</select>

 </div>
  <button id="download">🔊 توليد وتحميل MP3</button>

  <audio id="player" controls style="width:100%;margin-top:15px"></audio>

<script>
document.getElementById('download').onclick = async () => {
  const text = document.getElementById('txt').value.trim();
  if (!text) return alert('أدخل نصاً أولاً');

  const hl    = document.getElementById('lang').value;
  const voice = document.getElementById('voice').value.trim();

  // استدعاء الـ Function من Netlify
  const resp = await fetch('/.netlify/functions/tts-voicerss', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ text, hl, v: voice })
  });

  if (!resp.ok) { 
    alert('حدث خطأ في التوليد'); 
    return; 
  }

  // تحويل النتيجة إلى Blob (ملف صوت)
  const blob = await resp.blob();
  const url  = URL.createObjectURL(blob);

  // ✅ تشغيل الصوت في المشغل
  const player = document.getElementById('player');
  player.style.display = 'block';  // إظهار مشغل الصوت
  player.src = url;                // ربط ملف الصوت بالمشغل
  player.play();                   // تشغيل الصوت مباشرة

  // ✅ تنزيل الملف تلقائياً
  const a = document.createElement('a');
  a.href = url;
  a.download = 'speech.mp3';
  a.click();

  // تنظيف الرابط من الذاكرة
  URL.revokeObjectURL(url);
};
</script>
</body>
</html>
